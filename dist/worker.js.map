{"version":3,"file":"worker.js","sources":["../src/worker-types.js","../src/worker.js"],"sourcesContent":["/**\r\n * ONNX Web Worker 类型定义\r\n *\r\n * 定义 Worker 和主线程之间的消息协议\r\n */\r\n\r\n/**\r\n * Worker 消息类型枚举\r\n */\r\nexport const WorkerMessageType = {\r\n  INITIALIZE: 'initialize',\r\n  LOAD_MODEL: 'load_model',\r\n  RUN_INFERENCE: 'run_inference',\r\n  DISPOSE: 'dispose',\r\n  RESULT: 'result',\r\n  ERROR: 'error'\r\n};\r\n\r\n/**\r\n * 初始化配置\r\n */\r\nexport class InitializeConfig {\r\n  constructor(options = {}) {\r\n    /**\r\n     * WASM 文件路径配置\r\n     * @type {string | Record<string, string>}\r\n     */\r\n    this.wasmPaths = options.wasmPaths || null;\r\n\r\n    /**\r\n     * 是否使用 IndexedDB 缓存的 WASM 文件\r\n     * @type {boolean}\r\n     */\r\n    this.useIndexedDBWasm = options.useIndexedDBWasm || false;\r\n\r\n    /**\r\n     * 线程数量（0 = 使用默认值）\r\n     * @type {number}\r\n     */\r\n    this.numThreads = options.numThreads || 0;\r\n\r\n    /**\r\n     * 是否启用性能分析\r\n     * @type {boolean}\r\n     */\r\n    this.enableProfiling = options.enableProfiling || false;\r\n\r\n    /**\r\n     * 执行提供者列表\r\n     * @type {string[]}\r\n     */\r\n    this.executionProviders = options.executionProviders || ['wasm'];\r\n  }\r\n}\r\n\r\n/**\r\n * 张量数据\r\n */\r\nexport class TensorData {\r\n  constructor(data, dims, type = 'float32') {\r\n    /**\r\n     * 张量数据（Float32Array | Int32Array | Uint8Array）\r\n     */\r\n    this.data = data;\r\n\r\n    /**\r\n     * 张量维度\r\n     * @type {number[]}\r\n     */\r\n    this.dims = dims;\r\n\r\n    /**\r\n     * 数据类型\r\n     * @type {'float32' | 'int32' | 'uint8'}\r\n     */\r\n    this.type = type;\r\n  }\r\n}\r\n\r\n/**\r\n * 加载模型请求\r\n */\r\nexport class LoadModelRequest {\r\n  constructor(id, modelName, modelBuffer, sessionOptions = {}) {\r\n    /**\r\n     * 请求 ID\r\n     * @type {string}\r\n     */\r\n    this.id = id;\r\n\r\n    /**\r\n     * 请求类型\r\n     * @type {string}\r\n     */\r\n    this.type = WorkerMessageType.LOAD_MODEL;\r\n\r\n    /**\r\n     * 模型名称\r\n     * @type {string}\r\n     */\r\n    this.modelName = modelName;\r\n\r\n    /**\r\n     * 模型数据（ArrayBuffer）\r\n     * @type {ArrayBuffer}\r\n     */\r\n    this.modelBuffer = modelBuffer;\r\n\r\n    /**\r\n     * Session 配置选项\r\n     * @type {Object}\r\n     */\r\n    this.sessionOptions = sessionOptions;\r\n  }\r\n}\r\n\r\n/**\r\n * 推理请求\r\n */\r\nexport class RunInferenceRequest {\r\n  constructor(id, modelName, inputs) {\r\n    /**\r\n     * 请求 ID\r\n     * @type {string}\r\n     */\r\n    this.id = id;\r\n\r\n    /**\r\n     * 请求类型\r\n     * @type {string}\r\n     */\r\n    this.type = WorkerMessageType.RUN_INFERENCE;\r\n\r\n    /**\r\n     * 模型名称\r\n     * @type {string}\r\n     */\r\n    this.modelName = modelName;\r\n\r\n    /**\r\n     * 输入张量字典\r\n     * @type {Record<string, TensorData>}\r\n     */\r\n    this.inputs = inputs;\r\n  }\r\n}\r\n\r\n/**\r\n * Worker 响应\r\n */\r\nexport class WorkerResponse {\r\n  constructor(id, type, data = null, error = null) {\r\n    /**\r\n     * 响应 ID（对应请求 ID）\r\n     * @type {string}\r\n     */\r\n    this.id = id;\r\n\r\n    /**\r\n     * 响应类型\r\n     * @type {string}\r\n     */\r\n    this.type = type;\r\n\r\n    /**\r\n     * 响应数据\r\n     * @type {any}\r\n     */\r\n    this.data = data;\r\n\r\n    /**\r\n     * 错误信息（如果有）\r\n     * @type {string | null}\r\n     */\r\n    this.error = error;\r\n  }\r\n}\r\n\r\n/**\r\n * 模型信息\r\n */\r\nexport class ModelInfo {\r\n  constructor(modelName, inputNames, outputNames) {\r\n    /**\r\n     * 模型名称\r\n     * @type {string}\r\n     */\r\n    this.modelName = modelName;\r\n\r\n    /**\r\n     * 输入名称列表\r\n     * @type {string[]}\r\n     */\r\n    this.inputNames = inputNames;\r\n\r\n    /**\r\n     * 输出名称列表\r\n     * @type {string[]}\r\n     */\r\n    this.outputNames = outputNames;\r\n  }\r\n}\r\n","/**\r\n * ONNX Web Worker\r\n *\r\n * 在 Web Worker 中执行 ONNX 推理，避免阻塞主线程\r\n *\r\n * 使用方法:\r\n * 1. 宿主项目通过 Vite/Webpack 导入此 Worker\r\n * 2. 使用 createOnnxWorkerProxy 创建代理实例\r\n * 3. 调用 initialize(), loadModel(), run() 等方法\r\n */\r\n\r\nimport * as ort from 'onnxruntime-web';\r\nimport {\r\n  WorkerMessageType,\r\n  InitializeConfig,\r\n  LoadModelRequest,\r\n  RunInferenceRequest,\r\n  WorkerResponse,\r\n  ModelInfo,\r\n  TensorData\r\n} from './worker-types.js';\r\n\r\n/**\r\n * ONNX Worker 运行时\r\n *\r\n * 管理 ONNX Runtime 会话和模型\r\n */\r\nclass ONNXWorkerRuntime {\r\n  constructor() {\r\n    /**\r\n     * 已加载的模型会话\r\n     * @type {Map<string, ort.InferenceSession>}\r\n     */\r\n    this.models = new Map();\r\n\r\n    /**\r\n     * 是否已初始化\r\n     * @type {boolean}\r\n     */\r\n    this.isInitialized = false;\r\n\r\n    /**\r\n     * 初始化配置\r\n     * @type {InitializeConfig}\r\n     */\r\n    this.config = null;\r\n  }\r\n\r\n  /**\r\n   * 初始化 Worker 环境\r\n   *\r\n   * @param {InitializeConfig} config - 初始化配置\r\n   * @returns {Promise<{success: boolean}>}\r\n   */\r\n  async initialize(config) {\r\n    console.log('[ONNX Worker] 初始化...', config);\r\n\r\n    // 如果启用了 IndexedDB WASM 缓存\r\n    if (config.useIndexedDBWasm) {\r\n      await this._setupIndexedDBWasmLoader();\r\n      console.log('[ONNX Worker] 使用 IndexedDB WASM 加载器');\r\n    } else if (config.wasmPaths) {\r\n      // 设置 WASM 路径\r\n      if (typeof config.wasmPaths === 'string') {\r\n        ort.env.wasm.wasmPaths = config.wasmPaths;\r\n      } else {\r\n        ort.env.wasm.wasmPaths = config.wasmPaths;\r\n      }\r\n      console.log('[ONNX Worker] WASM 路径已设置:', config.wasmPaths);\r\n    }\r\n\r\n    // 设置线程数\r\n    if (config.numThreads && config.numThreads > 0) {\r\n      ort.env.wasm.numThreads = config.numThreads;\r\n    }\r\n\r\n    // 保存配置\r\n    this.config = config;\r\n    this.isInitialized = true;\r\n\r\n    console.log('[ONNX Worker] ✅ 初始化完成');\r\n\r\n    return { success: true };\r\n  }\r\n\r\n  /**\r\n   * 加载模型\r\n   *\r\n   * @param {LoadModelRequest} req - 加载模型请求\r\n   * @returns {Promise<ModelInfo>}\r\n   */\r\n  async loadModel(req) {\r\n    if (!this.isInitialized) {\r\n      throw new Error('Worker not initialized. Call initialize() first.');\r\n    }\r\n\r\n    console.log(`[ONNX Worker] 加载模型 '${req.modelName}'...`);\r\n\r\n    try {\r\n      // 创建推理会话\r\n      const sessionOptions = {\r\n        executionProviders: req.sessionOptions?.executionProviders ||\r\n          this.config?.executionProviders || ['wasm'],\r\n        enableProfiling: req.sessionOptions?.enableProfiling ??\r\n          this.config?.enableProfiling ?? false,\r\n        ...req.sessionOptions\r\n      };\r\n\r\n      const session = await ort.InferenceSession.create(\r\n        req.modelBuffer,\r\n        sessionOptions\r\n      );\r\n\r\n      // 保存会话\r\n      this.models.set(req.modelName, session);\r\n\r\n      console.log(`[ONNX Worker] ✅ 模型 '${req.modelName}' 加载成功`);\r\n      console.log('[ONNX Worker] 输入:', session.inputNames);\r\n      console.log('[ONNX Worker] 输出:', session.outputNames);\r\n\r\n      return new ModelInfo(\r\n        req.modelName,\r\n        session.inputNames,\r\n        session.outputNames\r\n      );\r\n\r\n    } catch (error) {\r\n      console.error(`[ONNX Worker] ❌ 加载模型失败:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 运行推理\r\n   *\r\n   * @param {RunInferenceRequest} req - 推理请求\r\n   * @returns {Promise<Record<string, TensorData>>}\r\n   */\r\n  async runInference(req) {\r\n    if (!this.isInitialized) {\r\n      throw new Error('Worker not initialized. Call initialize() first.');\r\n    }\r\n\r\n    console.log(`[ONNX Worker] 运行推理 '${req.modelName}'...`);\r\n\r\n    const session = this.models.get(req.modelName);\r\n    if (!session) {\r\n      throw new Error(`Model '${req.modelName}' not loaded. Call loadModel() first.`);\r\n    }\r\n\r\n    try {\r\n      // 将 TensorData 转换为 ort.Tensor\r\n      const feeds = {};\r\n      for (const [name, tensorData] of Object.entries(req.inputs)) {\r\n        const ortType = this._getOrtTensorType(tensorData.type);\r\n        feeds[name] = new ort.Tensor(\r\n          ortType,\r\n          tensorData.data,\r\n          tensorData.dims\r\n        );\r\n      }\r\n\r\n      // 运行推理\r\n      const startTime = performance.now();\r\n      const results = await session.run(feeds);\r\n      const endTime = performance.now();\r\n\r\n      console.log(`[ONNX Worker] ✅ 推理完成 (耗时: ${(endTime - startTime).toFixed(2)}ms)`);\r\n\r\n      // 将 ort.Tensor 转换为 TensorData\r\n      const output = {};\r\n      for (const [name, tensor] of Object.entries(results)) {\r\n        output[name] = new TensorData(\r\n          tensor.data,\r\n          tensor.dims,\r\n          this._getTensorDataType(tensor.type)\r\n        );\r\n      }\r\n\r\n      return output;\r\n\r\n    } catch (error) {\r\n      console.error(`[ONNX Worker] ❌ 推理失败:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置 IndexedDB WASM 加载器\r\n   * @private\r\n   */\r\n  async _setupIndexedDBWasmLoader() {\r\n    const WASM_CACHE_DB = 'onnx-wasm-cache';\r\n    const WASM_CACHE_STORE = 'wasm-files';\r\n    const WASM_CACHE_VERSION = 1;\r\n\r\n    // 打开 IndexedDB\r\n    const db = await new Promise((resolve, reject) => {\r\n      const request = indexedDB.open(WASM_CACHE_DB, WASM_CACHE_VERSION);\r\n      request.onerror = () => reject(request.error);\r\n      request.onsuccess = () => resolve(request.result);\r\n    });\r\n\r\n    // 读取 WASM 文件\r\n    const wasmFiles = await new Promise((resolve, reject) => {\r\n      const transaction = db.transaction([WASM_CACHE_STORE], 'readonly');\r\n      const store = transaction.objectStore(WASM_CACHE_STORE);\r\n      const request = store.getAll();\r\n\r\n      request.onsuccess = () => resolve(request.result || []);\r\n      request.onerror = () => reject(request.error);\r\n    });\r\n\r\n    console.log('[ONNX Worker] 从 IndexedDB 加载 WASM 文件:', wasmFiles.map(f => f.name));\r\n\r\n    // 创建 Blob URL 映射\r\n    const wasmPaths = {};\r\n    for (const entry of wasmFiles) {\r\n      const blob = new Blob([entry.data], { type: 'application/wasm' });\r\n      const url = URL.createObjectURL(blob);\r\n\r\n      // 提取文件名（不带路径）\r\n      const filename = entry.name;\r\n\r\n      wasmPaths[filename] = url;\r\n      console.log(`[ONNX Worker] ✅ 创建 Blob URL: ${filename} -> ${url}`);\r\n    }\r\n\r\n    // 设置 WASM 路径为 Blob URLs\r\n    ort.env.wasm.wasmPaths = wasmPaths;\r\n  }\r\n\r\n  /**\r\n   * 释放资源\r\n   */\r\n  async dispose() {\r\n    console.log('[ONNX Worker] 释放资源...');\r\n\r\n    for (const [modelName, session] of this.models.entries()) {\r\n      await session.release();\r\n      console.log(`[ONNX Worker] 已释放模型 '${modelName}'`);\r\n    }\r\n\r\n    this.models.clear();\r\n    this.isInitialized = false;\r\n\r\n    console.log('[ONNX Worker] ✅ 资源已释放');\r\n  }\r\n\r\n  /**\r\n   * 获取 ONNX Tensor 类型\r\n   * @private\r\n   */\r\n  _getOrtTensorType(type) {\r\n    const typeMap = {\r\n      'float32': 'float32',\r\n      'float64': 'float64',\r\n      'int8': 'int8',\r\n      'int16': 'int16',\r\n      'int32': 'int32',\r\n      'uint8': 'uint8',\r\n      'uint16': 'uint16',\r\n      'bool': 'bool'\r\n    };\r\n    return typeMap[type] || 'float32';\r\n  }\r\n\r\n  /**\r\n   * 获取数据类型字符串\r\n   * @private\r\n   */\r\n  _getTensorDataType(ortType) {\r\n    // ONNX Tensor type -> our type string\r\n    if (ortType === 'float32' || ortType === 'float') return 'float32';\r\n    if (ortType === 'int32' || ortType === 'int32') return 'int32';\r\n    if (ortType === 'uint8') return 'uint8';\r\n    return 'float32'; // 默认\r\n  }\r\n}\r\n\r\n// ============ Worker 消息处理 ============\r\n\r\nconst runtime = new ONNXWorkerRuntime();\r\n\r\n/**\r\n * 处理主线程发送的消息\r\n */\r\nself.onmessage = async (e) => {\r\n  const req = e.data;\r\n  const response = new WorkerResponse(req.id, WorkerMessageType.RESULT);\r\n\r\n  try {\r\n    switch (req.type) {\r\n      case WorkerMessageType.INITIALIZE:\r\n        response.data = await runtime.initialize(req.config || {});\r\n        break;\r\n\r\n      case WorkerMessageType.LOAD_MODEL:\r\n        response.data = await runtime.loadModel(req);\r\n        break;\r\n\r\n      case WorkerMessageType.RUN_INFERENCE:\r\n        response.data = await runtime.runInference(req);\r\n        break;\r\n\r\n      case WorkerMessageType.DISPOSE:\r\n        await runtime.dispose();\r\n        response.data = { success: true };\r\n        break;\r\n\r\n      default:\r\n        throw new Error(`Unknown message type: ${req.type}`);\r\n    }\r\n\r\n    // 发送成功响应\r\n    self.postMessage(response);\r\n\r\n  } catch (error) {\r\n    // 发送错误响应\r\n    response.type = WorkerMessageType.ERROR;\r\n    response.error = error instanceof Error ? error.message : String(error);\r\n    self.postMessage(response);\r\n  }\r\n};\r\n\r\n// 导出类型（用于 IDE 提示，实际在 Worker 中不使用）\r\nexport {\r\n  WorkerMessageType,\r\n  InitializeConfig,\r\n  LoadModelRequest,\r\n  RunInferenceRequest,\r\n  WorkerResponse,\r\n  ModelInfo,\r\n  TensorData\r\n};\r\n"],"names":[],"mappings":"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"}