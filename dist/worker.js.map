{"version":3,"file":"worker.js","sources":["../src/worker-types.js","../src/worker.js"],"sourcesContent":["/**\n * ONNX Web Worker 类型定义\n *\n * 定义 Worker 和主线程之间的消息协议\n */\n\n/**\n * Worker 消息类型枚举\n */\nexport const WorkerMessageType = {\n  INITIALIZE: \"initialize\",\n  LOAD_MODEL: \"load_model\",\n  RUN_INFERENCE: \"run_inference\",\n  DISPOSE: \"dispose\",\n  RESULT: \"result\",\n  ERROR: \"error\",\n};\n\n/**\n * 初始化配置\n */\nexport class InitializeConfig {\n  constructor(options = {}) {\n    /**\n     * WASM 文件路径配置\n     * @type {string | Record<string, string>}\n     */\n    this.wasmPaths = options.wasmPaths || null;\n\n    /**\n     * 线程数量（0 = 使用默认值）\n     * @type {number}\n     */\n    this.numThreads = options.numThreads || 0;\n\n    /**\n     * 是否启用性能分析\n     * @type {boolean}\n     */\n    this.enableProfiling = options.enableProfiling || false;\n\n    /**\n     * 执行提供者列表\n     * @type {string[]}\n     */\n    this.executionProviders = options.executionProviders || [\"wasm\"];\n  }\n}\n\n/**\n * 张量数据\n */\nexport class TensorData {\n  constructor(data, dims, type = \"float32\") {\n    /**\n     * 张量数据（Float32Array | Int32Array | Uint8Array | BigInt64Array）\n     */\n    this.data = data;\n\n    /**\n     * 张量维度\n     * @type {number[]}\n     */\n    this.dims = dims;\n\n    /**\n     * 数据类型\n     * @type {'float32' | 'int32' | 'uint8' | 'int64'}\n     */\n    this.type = type;\n  }\n}\n\n/**\n * 加载模型请求\n */\nexport class LoadModelRequest {\n  constructor(id, modelName, modelBuffer, sessionOptions = {}) {\n    /**\n     * 请求 ID\n     * @type {string}\n     */\n    this.id = id;\n\n    /**\n     * 请求类型\n     * @type {string}\n     */\n    this.type = WorkerMessageType.LOAD_MODEL;\n\n    /**\n     * 模型名称\n     * @type {string}\n     */\n    this.modelName = modelName;\n\n    /**\n     * 模型数据（ArrayBuffer）\n     * @type {ArrayBuffer}\n     */\n    this.modelBuffer = modelBuffer;\n\n    /**\n     * Session 配置选项\n     * @type {Object}\n     */\n    this.sessionOptions = sessionOptions;\n  }\n}\n\n/**\n * 推理请求\n */\nexport class RunInferenceRequest {\n  constructor(id, modelName, inputs) {\n    /**\n     * 请求 ID\n     * @type {string}\n     */\n    this.id = id;\n\n    /**\n     * 请求类型\n     * @type {string}\n     */\n    this.type = WorkerMessageType.RUN_INFERENCE;\n\n    /**\n     * 模型名称\n     * @type {string}\n     */\n    this.modelName = modelName;\n\n    /**\n     * 输入张量字典\n     * @type {Record<string, TensorData>}\n     */\n    this.inputs = inputs;\n  }\n}\n\n/**\n * Worker 响应\n */\nexport class WorkerResponse {\n  constructor(id, type, data = null, error = null) {\n    /**\n     * 响应 ID（对应请求 ID）\n     * @type {string}\n     */\n    this.id = id;\n\n    /**\n     * 响应类型\n     * @type {string}\n     */\n    this.type = type;\n\n    /**\n     * 响应数据\n     * @type {any}\n     */\n    this.data = data;\n\n    /**\n     * 错误信息（如果有）\n     * @type {string | null}\n     */\n    this.error = error;\n  }\n}\n\n/**\n * 模型信息\n */\nexport class ModelInfo {\n  constructor(modelName, inputNames, outputNames) {\n    /**\n     * 模型名称\n     * @type {string}\n     */\n    this.modelName = modelName;\n\n    /**\n     * 输入名称列表\n     * @type {string[]}\n     */\n    this.inputNames = inputNames;\n\n    /**\n     * 输出名称列表\n     * @type {string[]}\n     */\n    this.outputNames = outputNames;\n  }\n}\n","/**\n * ONNX Web Worker\n *\n * 在 Web Worker 中执行 ONNX 推理，避免阻塞主线程\n *\n * 使用方法:\n * 1. 宿主项目通过 Vite/Webpack 导入此 Worker\n * 2. 使用 createOnnxWorkerProxy 创建代理实例\n * 3. 调用 initialize(), loadModel(), run() 等方法\n */\n\nimport * as ort from \"onnxruntime-web\";\nimport {\n  WorkerMessageType,\n  InitializeConfig,\n  LoadModelRequest,\n  RunInferenceRequest,\n  WorkerResponse,\n  ModelInfo,\n  TensorData,\n} from \"./worker-types.js\";\n\n/**\n * ONNX Worker 运行时\n *\n * 管理 ONNX Runtime 会话和模型\n */\nclass ONNXWorkerRuntime {\n  constructor() {\n    /**\n     * 已加载的模型会话\n     * @type {Map<string, ort.InferenceSession>}\n     */\n    this.models = new Map();\n\n    /**\n     * 是否已初始化\n     * @type {boolean}\n     */\n    this.isInitialized = false;\n\n    /**\n     * 初始化配置\n     * @type {InitializeConfig}\n     */\n    this.config = null;\n  }\n\n  /**\n   * 初始化 Worker 环境\n   *\n   * @param {InitializeConfig} config - 初始化配置\n   * @returns {Promise<{success: boolean}>}\n   */\n  async initialize(config) {\n    console.log(\"[ONNX Worker] 初始化...\", config);\n\n    // 设置 WASM 路径\n    if (config.wasmPaths) {\n      if (typeof config.wasmPaths === \"string\") {\n        ort.env.wasm.wasmPaths = config.wasmPaths;\n      } else {\n        ort.env.wasm.wasmPaths = config.wasmPaths;\n      }\n      console.log(\"[ONNX Worker] WASM 路径已设置:\", config.wasmPaths);\n    }\n\n    // 设置线程数\n    if (config.numThreads && config.numThreads > 0) {\n      ort.env.wasm.numThreads = config.numThreads;\n    }\n\n    // 保存配置\n    this.config = config;\n    this.isInitialized = true;\n\n    console.log(\"[ONNX Worker] ✅ 初始化完成\");\n\n    return { success: true };\n  }\n\n  /**\n   * 加载模型\n   *\n   * @param {LoadModelRequest} req - 加载模型请求\n   * @returns {Promise<ModelInfo>}\n   */\n  async loadModel(req) {\n    if (!this.isInitialized) {\n      throw new Error(\"Worker not initialized. Call initialize() first.\");\n    }\n\n    console.log(`[ONNX Worker] 加载模型 '${req.modelName}'...`);\n\n    try {\n      // 创建推理会话\n      const sessionOptions = {\n        executionProviders: req.sessionOptions?.executionProviders ||\n          this.config?.executionProviders || [\"wasm\"],\n        enableProfiling:\n          req.sessionOptions?.enableProfiling ??\n          this.config?.enableProfiling ??\n          false,\n        ...req.sessionOptions,\n      };\n\n      const session = await ort.InferenceSession.create(\n        req.modelBuffer,\n        sessionOptions,\n      );\n\n      // 保存会话\n      this.models.set(req.modelName, session);\n\n      console.log(`[ONNX Worker] ✅ 模型 '${req.modelName}' 加载成功`);\n      console.log(\"[ONNX Worker] 输入:\", session.inputNames);\n      console.log(\"[ONNX Worker] 输出:\", session.outputNames);\n\n      return new ModelInfo(\n        req.modelName,\n        session.inputNames,\n        session.outputNames,\n      );\n    } catch (error) {\n      console.error(`[ONNX Worker] ❌ 加载模型失败:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * 运行推理\n   *\n   * @param {RunInferenceRequest} req - 推理请求\n   * @returns {Promise<Record<string, TensorData>>}\n   */\n  async runInference(req) {\n    if (!this.isInitialized) {\n      throw new Error(\"Worker not initialized. Call initialize() first.\");\n    }\n\n    console.log(`[ONNX Worker] 运行推理 '${req.modelName}'...`);\n\n    const session = this.models.get(req.modelName);\n    if (!session) {\n      throw new Error(\n        `Model '${req.modelName}' not loaded. Call loadModel() first.`,\n      );\n    }\n\n    try {\n      // 将 TensorData 转换为 ort.Tensor\n      const feeds = {};\n      for (const [name, tensorData] of Object.entries(req.inputs)) {\n        const ortType = this._getOrtTensorType(tensorData.type);\n        feeds[name] = new ort.Tensor(ortType, tensorData.data, tensorData.dims);\n      }\n\n      // 运行推理\n      const startTime = performance.now();\n      const results = await session.run(feeds);\n      const endTime = performance.now();\n\n      console.log(\n        `[ONNX Worker] ✅ 推理完成 (耗时: ${(endTime - startTime).toFixed(2)}ms)`,\n      );\n\n      // 将 ort.Tensor 转换为 TensorData\n      const output = {};\n      for (const [name, tensor] of Object.entries(results)) {\n        output[name] = new TensorData(\n          tensor.data,\n          tensor.dims,\n          this._getTensorDataType(tensor.type),\n        );\n      }\n\n      return output;\n    } catch (error) {\n      console.error(`[ONNX Worker] ❌ 推理失败:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * 释放资源\n   */\n  async dispose() {\n    console.log(\"[ONNX Worker] 释放资源...\");\n\n    for (const [modelName, session] of this.models.entries()) {\n      await session.release();\n      console.log(`[ONNX Worker] 已释放模型 '${modelName}'`);\n    }\n\n    this.models.clear();\n    this.isInitialized = false;\n\n    console.log(\"[ONNX Worker] ✅ 资源已释放\");\n  }\n\n  /**\n   * 获取 ONNX Tensor 类型\n   * @private\n   */\n  _getOrtTensorType(type) {\n    const typeMap = {\n      float32: \"float32\",\n      float64: \"float64\",\n      int8: \"int8\",\n      int16: \"int16\",\n      int32: \"int32\",\n      int64: \"int64\",\n      uint8: \"uint8\",\n      uint16: \"uint16\",\n      bool: \"bool\",\n    };\n    return typeMap[type] || \"float32\";\n  }\n\n  /**\n   * 获取数据类型字符串\n   * @private\n   */\n  _getTensorDataType(ortType) {\n    // ONNX Tensor type -> our type string\n    if (ortType === \"float32\" || ortType === \"float\") return \"float32\";\n    if (ortType === \"int32\" || ortType === \"int32\") return \"int32\";\n    if (ortType === \"int64\") return \"int64\";\n    if (ortType === \"uint8\") return \"uint8\";\n    return \"float32\"; // 默认\n  }\n}\n\n// ============ Worker 消息处理 ============\n\nconst runtime = new ONNXWorkerRuntime();\n\n/**\n * 处理主线程发送的消息\n */\nself.onmessage = async (e) => {\n  const req = e.data;\n  const response = new WorkerResponse(req.id, WorkerMessageType.RESULT);\n\n  try {\n    switch (req.type) {\n      case WorkerMessageType.INITIALIZE:\n        response.data = await runtime.initialize(req.config || {});\n        break;\n\n      case WorkerMessageType.LOAD_MODEL:\n        response.data = await runtime.loadModel(req);\n        break;\n\n      case WorkerMessageType.RUN_INFERENCE:\n        response.data = await runtime.runInference(req);\n        break;\n\n      case WorkerMessageType.DISPOSE:\n        await runtime.dispose();\n        response.data = { success: true };\n        break;\n\n      default:\n        throw new Error(`Unknown message type: ${req.type}`);\n    }\n\n    // 发送成功响应\n    self.postMessage(response);\n  } catch (error) {\n    // 发送错误响应\n    response.type = WorkerMessageType.ERROR;\n    response.error = error instanceof Error ? error.message : String(error);\n    self.postMessage(response);\n  }\n};\n\n// 导出类型（用于 IDE 提示，实际在 Worker 中不使用）\nexport {\n  WorkerMessageType,\n  InitializeConfig,\n  LoadModelRequest,\n  RunInferenceRequest,\n  WorkerResponse,\n  ModelInfo,\n  TensorData,\n};\n"],"names":[],"mappings":"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"}